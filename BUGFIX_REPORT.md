# üêõ –û—Ç—á–µ—Ç –æ –±–∞–≥–∞—Ö –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö

## –î–∞—Ç–∞: 17.10.2025

---

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ë–ê–ì–ò –ù–ê–ô–î–ï–ù–´:

### üî¥ –ë–ê–ì #1: –ë–æ—Ç –Ω–µ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø—ã
**–ü—Ä–æ–±–ª–µ–º–∞:**  
–ö–æ–¥ –ø—ã—Ç–∞–ª—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `bot.unban_chat_member()` –¥–ª—è "–¥–æ–±–∞–≤–ª–µ–Ω–∏—è" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —á–∞—Ç—ã. –°–æ–≥–ª–∞—Å–Ω–æ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Telegram Bot API](https://core.telegram.org/bots/api#unbanchatmember), —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ **—Ç–æ–ª—å–∫–æ —Å–Ω–∏–º–∞–µ—Ç –±–∞–Ω**, –Ω–æ –ù–ï –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø—É.

**–õ–æ–∫–∞—Ü–∏—è:** `bot/chat_manager.py:91`, `bot/chat_manager.py:626`

**–ü—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –Ω–µ–ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã Bot API. **–ë–æ—Ç—ã –Ω–µ –º–æ–≥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø—ã/—Å—É–ø–µ—Ä–≥—Ä—É–ø–ø—ã —á–µ—Ä–µ–∑ Bot API.**

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ó–∞–º–µ–Ω–∏–ª –º–µ—Ç–æ–¥ `add_user_to_chat()` –Ω–∞ `ensure_user_not_banned()` - —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ —Å–Ω–∏–º–∞–µ—Ç –±–∞–Ω
- ‚úÖ –î–æ–±–∞–≤–∏–ª –º–µ—Ç–æ–¥ `get_role_chat_invite_links()` - –ø–æ–ª—É—á–∞–µ—Ç invite links –¥–ª—è –≤—Å–µ—Ö —á–∞—Ç–æ–≤ —Ä–æ–ª–∏
- ‚úÖ –î–æ–±–∞–≤–∏–ª –º–µ—Ç–æ–¥ `get_chat_invite_link()` - —Å–æ–∑–¥–∞–µ—Ç invite link –¥–ª—è —á–∞—Ç–∞
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞—é—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ —á–∞—Ç—ã –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—é—Ç—Å—è —Å–∞–º–∏

---

### üî¥ –ë–ê–ì #2: –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –º–µ—Ç–æ–¥—ã `remove_user_from_all_chats()`
**–ü—Ä–æ–±–ª–µ–º–∞:**  
–í `bot/chat_manager.py` –±—ã–ª–æ –î–í–ê –º–µ—Ç–æ–¥–∞ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∏–º–µ–Ω–µ–º:
- –°—Ç—Ä–æ–∫–∏ 194-221 (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `chat_ids`)
- –°—Ç—Ä–æ–∫–∏ 310-346 (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `chat_ids`)

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–ª–æ—Ö–æ–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –£–¥–∞–ª–µ–Ω —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ (—Å—Ç—Ä–æ–∫–∏ 194-221)
- ‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `chat_ids`

---

### üî¥ –ë–ê–ì #3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –º–µ—Ç–æ–¥–∞ `kick_chat_member`
**–ü—Ä–æ–±–ª–µ–º–∞:**  
–í —Å—Ç—Ä–æ–∫–µ 389 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `kick_chat_member`, –∫–æ—Ç–æ—Ä—ã–π deprecated –≤ python-telegram-bot v20+.

**–õ–æ–∫–∞—Ü–∏—è:** `bot/chat_manager.py:389`

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –£–¥–∞–ª–µ–Ω –≤—ã–∑–æ–≤ `kick_chat_member`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `ban_chat_member` (–∞–∫—Ç—É–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥)

---

### üî¥ –ë–ê–ì #4: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø—ã
**–ü—Ä–æ–±–ª–µ–º–∞:**  
–ú–µ—Ç–æ–¥ `get_chat_members_from_telegram()` –ø—ã—Ç–∞–ª—Å—è –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ `get_updates()`, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–µ–¥–∞–≤–Ω–æ –ø–∏—Å–∞–≤—à–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏—è. **Bot API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø—ã.**

**–õ–æ–∫–∞—Ü–∏—è:** `bot/chat_manager.py:435-552`

**–ü—Ä–∏—á–∏–Ω–∞:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Bot API. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω—É–∂–µ–Ω Client API (pyrogram/telethon).

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `pyrogram==2.0.106` –∏ `tgcrypto==1.2.5`
- ‚úÖ –°–æ–∑–¥–∞–Ω –º–µ—Ç–æ–¥ `_get_members_with_pyrogram()` - –ø–æ–ª—É—á–∞–µ—Ç **–≤—Å–µ—Ö** —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ Client API
- ‚úÖ –°–æ–∑–¥–∞–Ω –º–µ—Ç–æ–¥ `_get_members_with_bot_api()` - fallback, –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã `API_ID` –∏ `API_HASH` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ –ú–µ—Ç–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç pyrogram –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∏–Ω–∞—á–µ Bot API

---

## ‚úÖ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø:

### 1. –û–±–Ω–æ–≤–ª–µ–Ω `config.py`
```python
# Telegram Client (for pyrogram - optional, for full member sync)
API_ID: int = int(os.getenv("API_ID", "0"))
API_HASH: str = os.getenv("API_HASH", "")
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω `env.example`
```env
# Telegram Client (Pyrogram) - Optional, for full chat member synchronization
# Get from https://my.telegram.org/apps
API_ID=0
API_HASH=
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω `requirements.txt`
```txt
python-telegram-bot==20.7
pyrogram==2.0.106  # NEW
tgcrypto==1.2.5     # NEW
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –≤ `admin_panel/routes.py`
- `/api/requests/{user_id}/approve` - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ensure_user_not_banned()` –≤–º–µ—Å—Ç–æ `add_user_to_chat()`
- `/api/users/{user_id}/rehire` - —Ç–æ–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

## üîß –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê –†–ê–ë–û–¢–´:

### –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å `approved` –≤ –ë–î
2. ‚úÖ –ï–º—É –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è —Ä–æ–ª—å
3. ‚úÖ –í –ë–î –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –æ —á–ª–µ–Ω—Å—Ç–≤–µ –≤ —á–∞—Ç–∞—Ö (—Ç–∞–±–ª–∏—Ü–∞ `chat_members`)
4. ‚úÖ –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–±–∞–Ω–µ–Ω –≤ —á–∞—Ç–∞—Ö (—Å–Ω–∏–º–∞–µ—Ç –±–∞–Ω –µ—Å–ª–∏ –µ—Å—Ç—å)
5. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ —á–∞—Ç—ã
6. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **—Å–∞–º** –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è –∫ —á–∞—Ç–∞–º –ø–æ —Å—Å—ã–ª–∫–∞–º

### –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1. ‚úÖ –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `fired` –≤ –ë–î
2. ‚úÖ –ó–∞–ø–∏—Å–∏ –≤ `chat_members` –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ `left`
3. ‚úÖ –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ban_chat_member()` + `unban_chat_member()` –¥–ª—è –∫–∏–∫–∞
4. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É–¥–∞–ª–µ–Ω–∏–∏

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:
1. ‚úÖ –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω pyrogram (API_ID, API_HASH) - –ø–æ–ª—É—á–∞–µ—Ç **–≤—Å–µ—Ö** —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
2. ‚úÖ –ò–Ω–∞—á–µ - –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Bot API)
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ –ë–î
4. ‚úÖ –£–¥–∞–ª—è–µ—Ç —Ç–µ—Ö, –∫—Ç–æ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

---

## üìù –ò–ù–°–¢–†–£–ö–¶–ò–ò –î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:

### –î–ª—è –ø–æ–ª–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://my.telegram.org/apps
2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–∏—Ç–µ `API_ID` –∏ `API_HASH`
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
   ```env
   API_ID=12345678
   API_HASH=–≤–∞—à_api_hash
   ```
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   pip install -r requirements.txt
   ```

### –ë–µ–∑ pyrogram:
–ë–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –±—É–¥–µ—Ç –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ —á–∞—Ç–∞.

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢:

‚úÖ **–ë–æ—Ç –±–æ–ª—å—à–µ –Ω–µ –ø—ã—Ç–∞–µ—Ç—Å—è "–¥–æ–±–∞–≤–ª—è—Ç—å" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ Bot API)**  
‚úÖ **–£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –∫–æ–¥**  
‚úÖ **–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã API**  
‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ pyrogram**  
‚úÖ **–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º Telegram API**

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø:

1. **Telegram Bot API –Ω–µ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø—ã** - —ç—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ API, –∞ –Ω–µ –±–∞–≥ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞.

2. **Telegram Bot API –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø—ã** - –Ω—É–∂–µ–Ω Client API (pyrogram).

3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã —Å–∞–º–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è –∫ —á–∞—Ç–∞–º –ø–æ invite links** - —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–±.

4. **–î–ª—è –∫–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ban + unban** - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± "–∫–∏–∫–Ω—É—Ç—å –±–µ–∑ –±–∞–Ω–∞".

---

## üìö –°–°–´–õ–ö–ò –ù–ê –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Æ:

- [Telegram Bot API](https://core.telegram.org/bots/api)
- [python-telegram-bot v20.7](https://docs.python-telegram-bot.org/)
- [pyrogram](https://docs.pyrogram.org/)
- [–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Bot API](https://core.telegram.org/bots/api#making-requests)

