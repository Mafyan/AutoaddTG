# 📝 User Control Bot - Краткое описание проекта

## 🎯 Что это?

**User Control Bot** - это комплексная система автоматизации управления доступом сотрудников к Telegram чатам на основе их ролей.

## ✨ Основные возможности

### Для сотрудников 👥
- ✅ Простая регистрация через бота (отправка номера телефона)
- ✅ Автоматическое получение ссылок на чаты после одобрения
- ✅ Проверка статуса заявки
- ✅ Получение актуальных ссылок в любое время

### Для администраторов 👨‍💼
- ✅ Удобная веб-панель управления
- ✅ Обработка заявок на регистрацию
- ✅ Управление ролями и их привязка к чатам
- ✅ Управление пользователями
- ✅ Управление чатами
- ✅ Статистика и аналитика

## 🏗️ Архитектура

```
┌─────────────────┐
│  Пользователь   │
│   (Telegram)    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐     ┌──────────────┐
│  Telegram Bot   │────▶│   Database   │
│  (Python)       │     │   (SQLite)   │
└─────────────────┘     └──────┬───────┘
                               │
                               ▼
┌─────────────────┐     ┌──────────────┐
│ Администратор   │────▶│  Admin Panel │
│   (Браузер)     │     │  (FastAPI)   │
└─────────────────┘     └──────────────┘
```

## 📦 Что входит в проект?

### 1. Telegram Bot
- Обработка команд пользователей
- Приём номеров телефона
- Отправка уведомлений
- Выдача ссылок на чаты

### 2. Админ-панель (Web)
- Современный UI на Bootstrap 5
- Управление заявками
- CRUD операции для пользователей, ролей, чатов
- Статистика в реальном времени

### 3. База данных
- SQLite (легкая, файловая)
- 5 таблиц: users, roles, chats, role_chats, admins
- Полная поддержка связей many-to-many

### 4. Система деплоя
- Автоматический скрипт установки
- Конфигурация Nginx
- Настройка Supervisor для автозапуска
- Поддержка SSL/HTTPS

## 🚀 Быстрый старт

### Windows

```batch
# 1. Установка
install.bat

# 2. Редактируйте .env (добавьте BOT_TOKEN)

# 3. Запуск
start_all.bat
```

### Linux

```bash
# 1. Установка
bash install.sh

# 2. Редактируйте .env (добавьте BOT_TOKEN)

# 3. Запуск
bash start_all.sh
```

### Ubuntu Server (Production)

```bash
sudo bash deploy/deploy.sh
```

## 📊 Технологический стек

| Компонент | Технология | Версия |
|-----------|-----------|--------|
| Язык | Python | 3.10+ |
| Telegram API | python-telegram-bot | 20.7 |
| Web Framework | FastAPI | 0.109.0 |
| ORM | SQLAlchemy | 2.0.25 |
| Database | SQLite | встроенная |
| Frontend | Bootstrap | 5.3.0 |
| Auth | JWT (python-jose) | 3.3.0 |
| Passwords | bcrypt (passlib) | 1.7.4 |

## 📁 Структура файлов

```
UserControlBot/
├── bot/              # Telegram бот
├── admin_panel/      # Веб-панель
├── database/         # База данных
├── static/           # CSS/JS
├── deploy/           # Конфигурация деплоя
└── templates/        # HTML шаблоны
```

Полная структура: [PROJECT_STRUCTURE.md](PROJECT_STRUCTURE.md)

## 🔐 Безопасность

- ✅ JWT токены для API
- ✅ Bcrypt для паролей
- ✅ Валидация входных данных
- ✅ HTTPS в продакшене
- ✅ Переменные окружения для секретов

## 📖 Документация

| Файл | Описание |
|------|----------|
| [README.md](README.md) | Полная документация |
| [QUICKSTART.md](QUICKSTART.md) | Быстрый старт за 5 минут |
| [instruction.md](instruction.md) | План разработки |
| [PROJECT_STRUCTURE.md](PROJECT_STRUCTURE.md) | Структура проекта |
| [deploy/README.md](deploy/README.md) | Инструкции по деплою |

## 🎬 Рабочий процесс

### Сценарий использования:

1. **Сотрудник** отправляет `/start` боту
2. Бот запрашивает номер телефона
3. Сотрудник отправляет номер
4. **Администратор** видит заявку в панели управления
5. Администратор выбирает роль и одобряет
6. **Бот автоматически** отправляет сотруднику ссылки на чаты
7. Сотрудник может в любой момент получить ссылки через `/mychats`

## 🔧 Основные команды

### Команды бота:
- `/start` - регистрация
- `/help` - справка
- `/status` - статус заявки
- `/mychats` - получить ссылки на чаты

### Команды управления:

**Для разработки:**
```bash
python -m database.init_db    # Инициализация БД
python run_bot.py              # Запуск бота
python run_admin.py            # Запуск панели
```

**Для продакшена:**
```bash
sudo supervisorctl status      # Статус сервисов
sudo supervisorctl restart all # Перезапуск
sudo tail -f /var/log/usercontrol_bot.out.log  # Логи
```

## 💡 Роли по умолчанию

При инициализации создаются:
1. Управляющий
2. Сервис-менеджер
3. Менеджер отдела продаж
4. Руководитель отдела продаж
5. Руководитель отдела сервиса
6. Технический специалист
7. HR-менеджер
8. Бухгалтер

Вы можете добавлять/удалять/изменять роли через панель управления.

## 📈 Статистика панели

Админ-панель показывает:
- 📊 Общее количество пользователей
- ⏳ Количество ожидающих заявок
- ✅ Количество одобренных пользователей
- ❌ Количество отклонённых заявок
- 👥 Количество ролей
- 💬 Количество чатов

## 🔄 Обновление

```bash
cd /opt/usercontrol
sudo supervisorctl stop all
git pull
source venv/bin/activate
pip install -r requirements.txt
sudo supervisorctl start all
```

## 🐛 Решение проблем

### Бот не отвечает
```bash
# Проверьте логи
sudo tail -f /var/log/usercontrol_bot.err.log

# Проверьте токен в .env
cat .env | grep BOT_TOKEN
```

### Панель недоступна
```bash
# Проверьте статус
sudo supervisorctl status usercontrol_admin

# Проверьте порт
sudo netstat -tulpn | grep 8000
```

## 📞 Поддержка

- 📚 Документация: [README.md](README.md)
- 🚀 Быстрый старт: [QUICKSTART.md](QUICKSTART.md)
- 🏗️ Структура: [PROJECT_STRUCTURE.md](PROJECT_STRUCTURE.md)
- 🌐 Деплой: [deploy/README.md](deploy/README.md)

## 📄 Лицензия

MIT License - см. [LICENSE](LICENSE)

## 🎉 Готово к использованию!

Проект полностью готов к развертыванию и использованию как в разработке, так и в продакшене.

---

**Версия:** 1.0.0  
**Дата создания:** 01.10.2025  
**Автор:** User Control Bot Team

