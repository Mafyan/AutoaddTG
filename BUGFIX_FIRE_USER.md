# üêõ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ë–æ—Ç –Ω–µ —É–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏–∏

## üìã **–û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´:**

**–°–∏–º–ø—Ç–æ–º—ã:**
1. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–£–≤–æ–ª–∏—Ç—å" –∏–ª–∏ "–£–¥–∞–ª–∏—Ç—å" –≤ –≤–µ–±-–ø–∞–Ω–µ–ª–∏ –±–æ—Ç **–ù–ï —É–¥–∞–ª—è–µ—Ç** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram —á–∞—Ç–æ–≤
2. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏ –±–æ—Ç —Å–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–ª—è–µ—Ç (–Ω–µ–ª–æ–≥–∏—á–Ω–æ)
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —á–∞—Ç–∞—Ö –¥–∞–∂–µ –ø–æ—Å–ª–µ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è

---

## üîç **–ü–†–ò–ß–ò–ù–ê –ë–ê–ì–ê:**

### **1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π**
–í —Ñ–∞–π–ª–µ `bot/chat_manager.py` –±—ã–ª–∏ **–î–í–ï —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º** `remove_user_from_chat`:

```python
# –°—Ç—Ä–æ–∫–∞ 115 - –ü–†–ê–í–ò–õ–¨–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è
async def remove_user_from_chat(self, chat_id: int, user_telegram_id: int) -> bool:
    await self.bot.ban_chat_member(chat_id, user_telegram_id)
    await self.bot.unban_chat_member(chat_id, user_telegram_id)  # ‚úÖ –†–∞–∑–±–∞–Ω–∏–≤–∞–µ—Ç
    return True

# –°—Ç—Ä–æ–∫–∞ 272 - –ù–ï–ü–†–ê–í–ò–õ–¨–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è (–ü–ï–†–ï–ó–ê–ü–ò–°–´–í–ê–ï–¢ –ø–µ—Ä–≤—É—é!)
async def remove_user_from_chat(self, chat_id: int, user_telegram_id: int) -> bool:
    await self.bot.ban_chat_member(chat_id, user_telegram_id)  # ‚ùå –ù–ï —Ä–∞–∑–±–∞–Ω–∏–≤–∞–µ—Ç!
    return True
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Ç–æ—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª–∞ –ø–µ—Ä–≤—É—é, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
- ‚úÖ –£–¥–∞–ª—è–ª—Å—è –∏–∑ —á–∞—Ç–∞
- ‚ùå **–û—Å—Ç–∞–≤–∞–ª—Å—è –≤ –±–∞–Ω–µ –Ω–∞–≤—Å–µ–≥–¥–∞**
- ‚ùå **–ù–µ –º–æ–≥ –≤–µ—Ä–Ω—É—Ç—å—Å—è** –¥–∞–∂–µ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ–¥–æ–±—Ä–µ–Ω–∏–∏

### **2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**
–ë–æ—Ç –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≤ —á–∞—Ç–µ –ø–µ—Ä–µ–¥ –ø–æ–ø—ã—Ç–∫–æ–π —É–¥–∞–ª–µ–Ω–∏—è.

### **3. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
–ù–µ –±—ã–ª–æ –≤–∏–¥–Ω–æ, –≥–¥–µ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ–π.

---

## ‚úÖ **–†–ï–®–ï–ù–ò–ï:**

### **1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é**
```python
# –ë—ã–ª–æ:
async def remove_user_from_chat(self, chat_id: int, user_telegram_id: int) -> bool:
    await self.bot.ban_chat_member(chat_id, user_telegram_id)
    return True

# –°—Ç–∞–ª–æ:
async def kick_user_from_chat(self, chat_id: int, user_telegram_id: int) -> bool:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –±–æ—Ç–∞
    bot_member = await self.bot.get_chat_member(chat_id, self.bot.id)
    if bot_member.status not in ['administrator', 'creator']:
        logger.warning(f"Bot is not admin in chat {chat_id}")
        return False
    
    # –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (ban + unban)
    await self.bot.ban_chat_member(chat_id, user_telegram_id)
    await self.bot.unban_chat_member(chat_id, user_telegram_id)  # ‚úÖ –í–ê–ñ–ù–û!
    return True
```

### **2. –û–±–Ω–æ–≤–∏–ª–∏ –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–∏**
```python
# –í remove_user_from_all_chats:
success = await self.kick_user_from_chat(chat_id, user_telegram_id)
```

### **3. –î–æ–±–∞–≤–∏–ª–∏ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
```python
print(f"üî• FIRING USER {user_id}")
print(f"üë§ User Telegram ID: {user.telegram_id}")
print(f"üìä Active Chat IDs: {active_chat_ids}")

for chat_id, result in removal_results.items():
    status = "‚úÖ SUCCESS" if result['success'] else "‚ùå FAILED"
    print(f"  Chat {chat_id}: {status}")
```

---

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢:**

### **–¢–µ–ø–µ—Ä—å –ø—Ä–∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏–∏:**
1. ‚úÖ –ë–æ—Ç **–ø—Ä–æ–≤–µ—Ä—è–µ—Ç**, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
2. ‚úÖ –ë–æ—Ç **—É–¥–∞–ª—è–µ—Ç** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —á–∞—Ç–∞ (ban)
3. ‚úÖ –ë–æ—Ç **—Å—Ä–∞–∑—É —Ä–∞–∑–±–∞–Ω–∏–≤–∞–µ—Ç** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (unban)
4. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç **–≤–µ—Ä–Ω—É—Ç—å—Å—è** –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ–¥–æ–±—Ä–µ–Ω–∏–∏
5. ‚úÖ –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è **–ª–æ–≥–∏—Ä—É—é—Ç—Å—è** –≤ –∫–æ–Ω—Å–æ–ª—å

### **Telegram –º–µ—Ö–∞–Ω–∏–∫–∞:**
- `ban_chat_member` - —É–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —á–∞—Ç–∞
- `unban_chat_member` - —Å–Ω–∏–º–∞–µ—Ç –±–∞–Ω (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ —á–∞—Ç–µ, –Ω–æ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è)
- **–ë–ï–ó unban** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–Ω–∞–≤—Å–µ–≥–¥–∞** –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏ –Ω–µ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è!

---

## üìù **–í–ê–ñ–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:**

### **–ë–æ—Ç –î–û–õ–ñ–ï–ù –±—ã—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≤ —á–∞—Ç–µ —Å –ø—Ä–∞–≤–∞–º–∏:**
- ‚úÖ **Ban users** (—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- ‚úÖ **Invite users via link** (–¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤:**
```bash
# –í Telegram —á–∞—Ç–µ:
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–∞ ‚Üí –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∫–ª—é—á–µ–Ω—ã –ø—Ä–∞–≤–∞:
   - "Ban users" ‚úÖ
   - "Invite users via link" ‚úÖ
```

---

## üöÄ **–û–ë–ù–û–í–õ–ï–ù–ò–ï –ù–ê –°–ï–†–í–ï–†–ï:**

```bash
cd /opt/usercontrol
git pull
sudo supervisorctl restart all
sudo supervisorctl status
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```bash
# –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –ø—Ä–∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏–∏:
sudo tail -f /var/log/usercontrol_admin.out.log

# –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
# üî• FIRING USER 123
# üë§ User Telegram ID: 456789012
# üìä Active Chat IDs: [-1001234567890]
# ‚úÖ Successfully removed from 1/1 chats
```

---

## üéâ **–ò–¢–û–ì:**

**–ë–∞–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω!** –¢–µ–ø–µ—Ä—å:
- –ë–æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ–¥–æ–±—Ä–µ–Ω–∏–∏
- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏—è–º–∏

